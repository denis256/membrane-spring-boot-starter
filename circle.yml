machine:
  java:
    version: openjdk8
test:
  post:
    - mkdir -p "$CIRCLE_TEST_REPORTS/junit"
    - find . -type f -regex '.*/target/surefire-reports/.*xml' -exec cp {} "$CIRCLE_TEST_REPORTS/junit" \;
    - bash <(curl -s https://codecov.io/bash)
deployment:
  pre-release:
    branch: master
    commands:
      - >
          mvn
          build-helper:parse-version
          versions:set -DgenerateBackupPoms=false -DnewVersion=\${parsedVersion.majorVersion}.\${parsedVersion.minorVersion}.\${parsedVersion.incrementalVersion}-${CIRCLE_BUILD_NUM}
          scm:checkin -Dmessage='Update pre-release version [ci skip]'
          scm:tag -Dtag='v${parsedVersion.majorVersion}.\${parsedVersion.minorVersion}.${parsedVersion.incrementalVersion}-${CIRCLE_BUILD_NUM}' -Dmessage='Pre-release version ${parsedVersion.majorVersion}.\${parsedVersion.minorVersion}.${parsedVersion.incrementalVersion}-${CIRCLE_BUILD_NUM}'
  release:
    tag: /v(?:[0-9]+\.){2}[0-9]+/
    commands:
      - mvn deploy -s circle.settings.xml -Prelease